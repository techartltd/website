<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>Transform_mch_anc_visit</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2020/01/20 16:25:05.930</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/01/20 16:25:05.930</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>mysql</name>
    <server/>
    <type>MYSQL</type>
    <access>JNDI</access>
    <database>mysql_tr</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
  </order>
  <step>
    <name>load_tr_mch_anc_visit</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>mysql</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>-- 20. Create mch visit transformed table
DROP TABLE IF EXISTS migration_tr.tr_mch_anc_visit;
CREATE TABLE migration_tr.tr_mch_anc_visit as
  select
    Person_Id,
    Encounter_Date,
    Encounter_ID,
    Anc_visit_number,
    Anc_number,
    Temperature,
    Pulse_rate,
    Systolic_bp,
    Diastolic_bp,
    Respiratory_rate,
    Oxygen_saturation,
    Weight,
    Height,
    Muac,
    Hemoglobin,
    (case Breast_exam_done
     when "yes" then 1065
     when "No" then 1066  when "N/A" then 1175 else NULL end) as Breast_exam_done,
    Pallor,
    Maturity,
    Fundal_height,
    Fetal_presentation,
    Lie,
    Fetal_heart_rate,
    Fetal_movement,
    (case Who_stage when "Stage1" then 1204
     when "Stage2" then 1205
     when "Stage3" then 1206
     when "Stage4" then 1207 else NULL end )as Who_stage,
    (case Viral_load_sample_taken
     when "yes" then 1065
     when "No" then 1066  when "N/A" then 1175 else NULL end) as Viral_load_sample_taken,
    (case Test_1_Kit_Name
     when "First Response" then 164961
     when "Determine" then 164960
     when "Other" then 1175  else NULL end) as Test_1_Kit_Name,
    Test_1_kit_lot_no,
    Test_1_kit_expiry,
    (case Test_1_Result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else NULL end)as  Test_1_Result,
    (case Test_2_Kit_Name
     when "First Response" then 164961
     when "Determine" then 164960
     when "Other" then 1175  else NULL end)as  Test_2_Kit_Name,
    Test_2_kit_lot_no,
    Test_2_kit_expiry,
    (case Test_2_Result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else NULL end)as  Test_2_Result,
    (case  Final_test_result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else NULL end)as  Final_test_result,
    (case Patient_given_result
     when "Yes" then 1065
     when "No" then 1066  else '' end)as Patient_given_result,
    (case Partner_hiv_tested
     when "Yes" then 1065
     when "No" then 1066  when "N/A" then 1175 else NULL end) as  Partner_hiv_tested,
    (case Partner_hiv_status
     when "Negative" then 664
     when  "Positive" then 703
     when "Unknown" then 1067 else NULL end) as Partner_hiv_status,
    Urine_microscopy,
    Urinary_albumin,
    Glucose_measurement,
    Urine_ph,
    Urine_gravity,
    Urine_nitrite_test,
    Urine_leukocyte_esterace_test,
    Urinary_ketone,
    Urine_bile_salt_test,
    Urine_bile_pigment_test,
    Urine_colour,
    Urine_turbidity,
    Urine_dipstick_for_blood,
    (case Syphilis_test_status
     when "No" then 1066
     when "yes" then 1065
     when "Unknown" then 1067  else NULL end)as  Syphilis_test_status,
    (case Syphilis_treated_status
     when "Positive" then 703
     when "Negative" then 664
     when "Not Done" then 1118  else NULL end)as  Syphilis_treated_status,
    Bs_for_mps,
   (case Anc_exercises
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else NULL end)as  Anc_exercises,
    (case TB_screening_results
     when "No TB" then 1660
     when "PrTB" then 142177
     when "TBRx" then 1662
     when "Not Done" then 1118  else NULL end)as Tb_screening_results,
    (case Cacx_screening
     when "No" then 1066
     when "yes" then 1066
     when "Confirmed" then 703
     when "Suspected" then 159393
     when "N/A" then 1175
     when "Normal" then 664
     when "Never" then 1090
     when "Not Done" then 1118 end)as Cacx_screening,
    (case Cacx_screening_method
     when "Pap Smear" then 885
     when "VIA" then 162816
     when "VIA/VILI" then 162816
     when "VILI" then 164977
     when "Other" then 5622
     when "Not Done" then 1118
     when "Not Applicable" then 1175 end)as Cacx_screening_method,
    (case Prophylaxis_given
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else NULL end)as  Prophylaxis_given,
    (case Baby_azt_dispensed
     when "No" then 1066
     when "Yes" then 1065
     when "N/A" then 1175  else NULL end)as  Baby_azt_dispensed,
   (case Baby_nvp_dispensed
    when "No" then 1066
    when "Yes" then 1065
    when "N/A" then 1175  else NULL end)as  Baby_nvp_dispensed,
    (case Has_other_illnes
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else NULL end)as  Has_other_illnes,
    (case Drug
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else NULL end)as  Drug,
    (case Anc_counselled
     when "NO" then 1066
     when "YES" then 1065
     when "Unknown" then 1067  else NULL end)as  Anc_counselled,
    (case Counselled_subject
     when "Birth Plans" then 159758
     when "Danger Signs" then 159857
     when "HIV" then 1914
     when "Infant Feeding" then 161651
     when "Family Planning" then 156277
     when "Insecticide Treated Nets" then 1381
     when "Supplimental feeding" then 159854
     when "Breast Care" then 159856
     when "Unknown" then 1067  else NULL end)as  Counselled_subject,
 (case Referred_From
     when "Another Health Facility" then 164407
     when "Current Health Facility" then 163266
     when "Community Unit" then 160543
     when "Unknown" then 1067  else NULL end)as  Referred_From,
 (case Referred_To
     when "Another Health Facility" then 164407
     when "Current Health Facility" then 163266
     when "Community Unit" then 160543
     when "Unknown" then 1067  else NULL end)as  Referred_To,
    Next_appointment_date,
    Clinical_notes,
    Voided
  FROM migration_st.st_mch_enrollment_visit WHERE
       (Encounter_Date != "" OR Encounter_Date IS NOT NULL)
  GROUP BY Person_Id, Encounter_Date;
</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
